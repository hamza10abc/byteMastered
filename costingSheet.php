<div style="overflow:auto">
    <table class="items-center w-full bg-transparent border-collapse display" id="example">
        <thead>
            <tr>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left"></th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left">Particular</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px"></th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Direct</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Material</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Direct</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Labour</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">(4% & 2%)</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Prime Cost</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Unit Produced</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Prime Cost</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">(1.5%)</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Cost of</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Whole Sale</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Profit</th>
            </tr>
        </thead>
        <thead>
            <tr>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left">S.No.</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left">Product</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Type</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Raw Material</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Packaging Material</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">In Production</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">In Packaging</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Direct Expense</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Per Ghan</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Per Ghan</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Per Unit</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">FREIGHT</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Sale</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Price</th>
                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left min-w-140-px">Per Unit</th>
            </tr>
        </thead>

        <tbody>


            <?php
            $sql = "SELECT * FROM `product`";
            $result = mysqli_query($conn, $sql);
            $sno = 0;
            while ($row = mysqli_fetch_assoc($result)) {
                $idProd = $row['_id'];
                $nameOfProd = $row['name'];
                $sizeOfProd = $row['sizes'];
                $typeOfProd = $row['type'];
                // echo $idProd;


                // Raw material search
                $sqlRawMatSearch = "SELECT product_details.pid, product_details.raw_id, product_details.qty, raw_material.final_rate, raw_material._id from product_details JOIN raw_material on product_details.raw_id = raw_material._id WHERE product_details.pid = $idProd;";
                $resultRawMatSearch = mysqli_query($conn, $sqlRawMatSearch);
                $totalCostOfRawMat = 0;
                while ($rowRawMat = mysqli_fetch_assoc($resultRawMatSearch)) {
                    $quantity = $rowRawMat['qty'];
                    $finalRate = $rowRawMat['final_rate'];
                    $intermediateCost = $quantity * $finalRate;
                    $totalCostOfRawMat += $intermediateCost;
                }



                // Packaging material search
                $sqlPackMaterial = "SELECT packaging_material.pid, packaging_material.cover_box, packaging_material.label, packaging_material.jar, packaging_material.cartoon, packaging_material.cap, product._id from packaging_material JOIN product on packaging_material.pid = product._id WHERE product._id = $idProd;";
                $resultPackMaterial = mysqli_query($conn, $sqlPackMaterial);
                while ($rowPackMat = mysqli_fetch_assoc($resultPackMaterial)) {
                    $sqlLabour = "SELECT unit_prds_per_ghan FROM labour_in_packing WHERE pid = $idProd";
                    $resultLabour = mysqli_query($conn, $sqlLabour);
                    while ($labourRow = mysqli_fetch_assoc($resultLabour)) {
                        $uL = $labourRow['unit_prds_per_ghan'];
                    }
                    $coverBox = $rowPackMat['cover_box'];
                    $jar = $rowPackMat['jar'];
                    $label = $rowPackMat['label'];
                    $cartoon = $rowPackMat['cartoon'];
                    $cap = $rowPackMat['cap'];
                    $totalCost = $coverBox + $jar + $label + $cartoon + $cap;
                    $unitLot = $uL;
                    $totalCostLot = $totalCost * $unitLot;
                }





                // Labour search
                $sqlEmpData = "SELECT SUM(gross_salary) from employee";
                $runSqlEmpData = mysqli_query($conn, $sqlEmpData);
                $row = mysqli_fetch_array($runSqlEmpData);
                $totalEmpSal = $row[0];


                $sqlCountEmp = "SELECT count(*) from employee";
                $runSqlCountEmp = mysqli_query($conn, $sqlCountEmp);
                $row = mysqli_fetch_array($runSqlCountEmp);
                $totalEmp = $row[0];
                // echo $totalEmp;

                $middleCal = $totalEmpSal / $totalEmp;

                $final = $middleCal / 26;


                $sqlLabourData = "SELECT * FROM `labour_in_packing` where pid = $idProd";
                $resultLabourData = mysqli_query($conn, $sqlLabourData);
                while ($rowLabour = mysqli_fetch_assoc($resultLabourData)) {
                    $empCostDay = $final;
                    $costFilling = ($rowLabour['unit_prds_per_ghan'] / $rowLabour['filling']) * $empCostDay;
                    $costSealing = ($rowLabour['unit_prds_per_ghan'] / $rowLabour['sealing']) * $empCostDay;
                    $costPacking = ($rowLabour['unit_prds_per_ghan'] / $rowLabour['packing']) * $empCostDay;
                    $totalCostLabour = $costFilling + $costPacking + $costSealing;
                    $totalCostLabourInPackaging = (($rowLabour['unit_prds_per_ghan'] / $rowLabour['filling']) * $rowLabour['other']) + (($rowLabour['unit_prds_per_ghan'] / $rowLabour['sealing']) * $rowLabour['other']) + (($rowLabour['unit_prds_per_ghan'] / $rowLabour['packing']) * $rowLabour['other']);
                }





                // lot ghan search
                $sqlLot = "SELECT * FROM `lot_ghan` where pid = $idProd";
                $resultData = mysqli_query($conn, $sqlLot);
                while ($rowLot = mysqli_fetch_assoc($resultData)) {
                    $lotData = $rowLot['pks_output'];
                }


                $overheadTotal = ($totalCostOfRawMat + $totalCostLot + $totalCostLabour) * 6 / 94;
                $primeCost = $totalCostOfRawMat + $totalCostLot + $totalCostLabour + $overheadTotal;
                $lotDataLink = $lotData;
                $primeCostPerUnit = $primeCost / $lotDataLink;
                $freight = $primeCostPerUnit * 0.015;
                $costOfSale = $primeCostPerUnit + $freight;
                $wholeSalePrice = 10; //???
                $profitPerUnit = $wholeSalePrice - $primeCostPerUnit;

                $sno += 1;
                echo "
                    <tr class='text-gray-700 dark:text-black'>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>" . $sno . "</td>
                            
                        <th class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left'><a href ='viewProd.php?id=" . $idProd . "'>" . $nameOfProd . " - " . $sizeOfProd . "
                        </a>
                        </th>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $typeOfProd . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $totalCostOfRawMat . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $totalCostLot . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $totalCostLabour . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $totalCostLabourInPackaging . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $overheadTotal . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $primeCost . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $lotDataLink . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $primeCostPerUnit . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $freight . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $costOfSale . "
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            EMPTY
                        </td>
                        <td class='border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4'>
                            " . $profitPerUnit . "
                        </td>
                    </tr>
                ";
            }
            ?>

        </tbody>
    </table>
</div>